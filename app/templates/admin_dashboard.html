{% extends "base.html" %}

{% block title %}Admin Dashboard - CBT 12-Step Assessment{% endblock %}

{% block content %}
<h2>Admin Dashboard</h2>
<p>Welcome, {{ current_user.first_name }} {{ current_user.last_name }}</p>

{% if current_user.role == 'supervisor' %}
<div class="alert alert-primary">
    <h3 style="margin-bottom: 0.5rem;">Management</h3>
    <p class="mb-1 text-muted">Manage users, admins, and assessments</p>

    <a href="{{ url_for('manage.list_users') }}" class="btn" style="background: #007bff; margin-right: 0.5rem;">
        Manage Users
    </a>

    <a href="{{ url_for('manage.list_admins') }}" class="btn" style="background: #6c757d;">
        Manage Admins
    </a>
</div>
{% endif %}

<hr>

<h3 class="mt-1">Pending Assessments ({{ pending_attempts|length }})</h3>

{% if pending_attempts %}
<table>
    <thead>
    <tr>
        <th>Participant</th>
        <th>State ID</th>
        <th>Step</th>
        <th>Submitted</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    {% for attempt in pending_attempts %}
    <tr>
        <td>
            {{ attempt.user.first_name }} {{ attempt.user.last_name }}
        </td>
        <td>
            {{ attempt.state_id }}
        </td>
        <td>
            Step {{ attempt.assessment.step.step_number }}
        </td>
        <td>
            {{ attempt.submitted_at.strftime('%B %d, %Y at %I:%M %p') }}
        </td>
        <td>
            <a href="{{ url_for('admin.review_attempt', attempt_id=attempt.attempt_id) }}" class="btn" style="padding: 0.5rem 1rem;">
                Review
            </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-muted" style="font-style: italic;">No pending assessments at this time.</p>
{% endif %}

<hr class="mt-1">

<a href="{{ url_for('main.logout') }}" class="btn">Logout</a>
{% endblock %}
